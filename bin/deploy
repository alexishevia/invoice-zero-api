#!/bin/bash

set -e # exit if any command fails

CURRENT_FILE=`realpath $0`
CURRENT_DIR=`dirname $CURRENT_FILE`

# read version from package.json
version="v$(cat $CURRENT_DIR/../api/package.json | jq -r .version)"

# create git tag and push to origin
git tag $version
git push --tags

# build docker image with latest code
docker build $CURRENT_DIR/.. -t alexishevia/invoice-zero-api

# tag docker image and push to dockerhub
docker tag alexishevia/invoice-zero-api:latest "alexishevia/invoice-zero-api:${version}"
docker push alexishevia/invoice-zero-api:latest
docker push "alexishevia/invoice-zero-api:${version}"
